<!DOCTYPE html>
<html>
<head>
    <title>Story/Item Creation</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <link rel="stylesheet" href="../static/style/style.css">
</head>
<body class="dark-mode">

    <div class="container-fluid h-100">
        <div class="row h-100 justify-content-center align-items-center">
            <div class="col-md-6">

                <p id="dark_p" onclick=toggle() class="text-danger text-right mt-5 mb-1 small">Dark Mode</p>
                <div class="mt-0 form-group text-right">
                    <div class="custom-control switch" id="switchDiv">
                        <p id="switch"></p>
                    </div>
                </div>
                
                <div class="text-center">
                    <h1 class="text-danger my-4">Story Creation:</h1>
                </div>

                <form id="storyForm" action="/register_story_item" method="post">

                    {% with messages = get_flashed_messages(category_filter=['story_item']) %}
                        {% if messages %}
                            <div class="alert alert-danger" role="alert">
                                <strong><u>Entry Error:</u></strong>
                                {% for message in messages %}
                                    <p class="mt-2"> - {{message}}</p>
                                {% endfor %}
                            </div>
                        {% endif %}
                    {% endwith %}

                    <a href="/admin_story_alt" class="d-flex justify-content-center btn btn-link text-center text-primary] small"> - Clear Form - </a>

                    <div class="form-group">
                        <label for="story_title" class="text-danger">Story Title</label>
                        {% if session['story_title'] %}
                            <input value="{{session['story_title']}}" type="text" class="form-control" name="story_title" id="story_title" placeholder="Enter title...">
                        {% else %}
                            <input type="text" class="form-control" name="story_title" id="story_title" placeholder="Enter title...">
                        {% endif %}
                    </div>
                    <div class="form-group">
                        <label for="description" class="text-danger">Story Description</label>
                        {% if session['description'] %}
                            <textarea value="{{session['description']}}" rows="3" class="form-control" name="description" id="description" placeholder="Enter description..."></textarea>
                        {% else %}
                            <textarea rows="3" class="form-control" name="description" id="description" placeholder="Enter description..."></textarea>
                        {% endif %}
                    </div>
                    <div class="form-group mb-0">
                        <label for="lookup_key" class="text-danger d-flex-inline justify-content-between">Story Lookup-Key</label>
                        <div class="ml-1 row justify-content-start">
                            {% if session['lookup_key'] %}
                                <input value="{{session['lookup_key']}}" type="text" class="form-control col-10" name="lookup_key" id="lookup_key" placeholder="Create or generate lookup-key...">
                                <p class="col-2" id="refresh-text" style="line-height: 2.3em;">ðŸ”„</p>
                            {% else %}
                                <input type="text" class="form-control col-10" name="lookup_key" id="lookup_key" placeholder="Create or generate lookup-key...">
                                <p class="col-2" id="refresh-text" style="line-height: 2.3em;">ðŸ”„</p>
                            {% endif %}
                        </div>    
                    </div>
                    <div class="form-group">
                        <label for="item_content" class="text-danger">Item Content</label>
                        <input type="text" class="form-control" name="item_content" id="item_content" placeholder="Enter item content...">
                    </div>

                    <div class="d-flex justify-content-center align-items-center">
                        <a href="/admin_dashboard" class="btn btn-link text-center text-danger text-decoration-none col-2 mr-3 border-danger">Cancel</a>
                        <button type="submit" value="Enter" class="my-4 btn btn-danger btn-block col-9">Submit Story</button>
                    </div>
                </form>

            </div>
        </div>
    </div>

    <script>
        let switchBtn = document.querySelector("#switch");
        const body = document.querySelector("body");
        const html = document.querySelector("html");

        switchBtn.addEventListener("change", (event) => {
            if(event.target.checked){
                body.classList.remove("light-mode");
                body.classList.add("dark-mode");
                html.classList.add("dark-mode");
            } else {
                body.classList.remove("dark-mode");
                body.classList.add("light-mode");
                html.classList.remove("dark-mode");
            }
        });

        function toggle(){

            let switchToggle

            document.getElementById("switchDiv").innerHTML.length <= 65 ? 
                switchToggle = true : 
                switchToggle = false

            if(switchToggle){

                if(body.classList.contains("light-mode")){
                    body.classList.remove("light-mode");
                    body.classList.add("dark-mode");
                    html.classList.add("dark-mode");
                }
                    
                document.getElementById("switchDiv").innerHTML = 
                `
                    <input type="checkbox" class="custom-control-input switch" id="switch" name="switch" checked/>
                    <label class="form control custom-control-label text-danger" for="switch"></label>
                `
            } else {
                document.getElementById("switchDiv").innerHTML = `<p id="switch"></p>`
            }

            switchBtn = document.querySelector("#switch");

            switchBtn.addEventListener("change", (event) => {
                if(event.target.checked){
                    body.classList.remove("light-mode");
                    body.classList.add("dark-mode");
                    html.classList.add("dark-mode");
                } else {
                    body.classList.remove("dark-mode");
                    body.classList.add("light-mode");
                    html.classList.remove("dark-mode");
                }
            });
        }

        function clearForm(){
            document.getElementById("regForm").reset();
        }

        const apiKey = `{{ apiKey }}`
        
        window.onload = function() {
            document.getElementById("refresh-text").addEventListener("click", function(){
                    fetch("https://api.random.org/json-rpc/1/invoke", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            jsonrpc: "2.0",
                            method: "generateStrings",
                            params: {
                                apiKey: apiKey,
                                n: 1,
                                length: 8,
                                characters: "abcdefghjklmnprtuvwyABCDEFGHJKLMNPRTUVWY123456789",
                                replacement: true
                            },
                            id: 42                  
                        })
                    })
                        .then(response => response.json())
                        .then(data => {
                            console.log(data.result.random.data[0]);
                            document.getElementById('lookup_key').value = data.result.random.data[0].toUpperCase()
                    });
            });
        }
        

    </script>

</body>
</html>
