<!DOCTYPE html>
<html>
<head>
    <title>Story/Item Creation</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <link rel="stylesheet" href="../static/style/style.css">
</head>
<body class="dark-mode">

    <div class="container-fluid h-100">
        <div class="row h-100 justify-content-center align-items-center">
            <div class="col-md-6">

                <p id="dark_p" onclick=toggle() class="text-danger text-right mt-5 mb-1 small">Dark Mode</p>
                <div class="mt-0 form-group text-right">
                    <div class="custom-control switch" id="switchDiv">
                        <p id="switch"></p>
                    </div>
                </div>
                
                <div class="text-center">
                    <h1 class="text-danger my-4">Story Creation:</h1>
                </div>

                <form id="storyForm" action="/story" method="post">

                    {% with messages = get_flashed_messages(category_filter=['story']) %}
                        {% if messages %}
                            <div class="alert alert-danger" role="alert">
                                <strong><u>Entry Error:</u></strong>
                                {% for message in messages %}
                                    <p class="mt-2"> - {{message}}</p>
                                {% endfor %}
                            </div>
                        {% endif %}
                    {% endwith %}

                    <a href="/admin_story_refresh" class="d-flex justify-content-center btn btn-link text-center text-white small"> - Clear Form - </a>

                    <div class="form-group">
                        <label for="story_item" class="text-danger">Story Title</label>
                        {% if session['story_item'] %}
                            <input value="{{session['story_item']}}" type="text" class="form-control" name="story_item" id="story_item" placeholder="Enter title...">
                        {% else %}
                            <input type="text" class="form-control" name="story_item" id="story_item" placeholder="Enter title...">
                        {% endif %}
                    </div>
                    <div class="form-group">
                        <label for="description" class="text-danger">Story Description</label>
                        {% if session['description'] %}
                            <input value="{{session['description']}}" type="text" class="form-control" name="description" id="description" placeholder="Enter description...">
                        {% else %}
                            <input type="text" class="form-control" name="description" id="description" placeholder="Enter description...">
                        {% endif %}
                    </div>
                    <div class="form-group">
                        <label for="lookup_key" class="text-danger">Story Lookup Key</label>
                        {% if session['lookup_key'] %}
                            <input value="{{session['lookup_key']}}" type="text" class="form-control" name="lookup_key" id="lookup_key" placeholder="Enter story lookup key...">
                        {% else %}
                            <input type="text" class="form-control" name="lookup_key" id="lookup_key" placeholder="Enter story lookup key...">
                        {% endif %}
                    </div>
                    <div class="form-group">
                        <label for="relationship" class="text-danger">Character's Relationship</label>
                        {% if session['relationship'] %}
                            <input value="{{session['relationship']}}" type="text" class="form-control" name="relationship" id="relationship" placeholder="Enter relationship...">
                        {% else %}
                            <input type="text" class="form-control" name="relationship" id="relationship" placeholder="Enter relationship...">
                        {% endif %}
                    </div>
                    <div class="form-group">
                        <label for="potential_motive" class="text-danger">Potential Motive</label>
                        {% if session['potential_motive'] %}
                            <input value="{{session['potential_motive']}}" type="textarea" rows="3" resize="vertical" class="form-control" name="potential_motive" id="potential_motive" placeholder="Why murder?">
                        {% else %}
                            <input type="textarea" rows="3" resize="vertical" class="form-control" name="potential_motive" id="potential_motive" placeholder="Why murder?">
                        {% endif %}
                    </div>

                    <div class="d-flex justify-content-center align-items-center">
                        <a href="/admin_dashboard" class="btn btn-link text-center text-danger text-decoration-none col-2 mr-3 border-danger">Cancel</a>
                        <button type="submit" value="Enter" class="my-4 btn btn-danger btn-block col-9">Submit Story</button>
                    </div>
                </form>

            </div>
        </div>
    </div>

    <script>
        let switchBtn = document.querySelector("#switch");
        const body = document.querySelector("body");
        const html = document.querySelector("html");

        switchBtn.addEventListener("change", (event) => {
            if(event.target.checked){
                body.classList.remove("light-mode");
                body.classList.add("dark-mode");
                html.classList.add("dark-mode");
            } else {
                body.classList.remove("dark-mode");
                body.classList.add("light-mode");
                html.classList.remove("dark-mode");
            }
        });

        function toggle(){

            let switchToggle

            document.getElementById("switchDiv").innerHTML.length <= 65 ? 
                switchToggle = true : 
                switchToggle = false

            if(switchToggle){

                if(body.classList.contains("light-mode")){
                    body.classList.remove("light-mode");
                    body.classList.add("dark-mode");
                    html.classList.add("dark-mode");
                }
                    
                document.getElementById("switchDiv").innerHTML = 
                `
                    <input type="checkbox" class="custom-control-input switch" id="switch" name="switch" checked/>
                    <label class="form control custom-control-label text-danger" for="switch"></label>
                `
            } else {
                document.getElementById("switchDiv").innerHTML = `<p id="switch"></p>`
            }

            switchBtn = document.querySelector("#switch");

            switchBtn.addEventListener("change", (event) => {
                if(event.target.checked){
                    body.classList.remove("light-mode");
                    body.classList.add("dark-mode");
                    html.classList.add("dark-mode");
                } else {
                    body.classList.remove("dark-mode");
                    body.classList.add("light-mode");
                    html.classList.remove("dark-mode");
                }
            });
        }

        function clearForm(){
            document.getElementById("regForm").reset();
        }

    </script>

</body>
</html>
